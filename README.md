# Introduction
The **nk-realtime-service** project serves as a pilot project and/or a reference to be used by anyone who wishes to write software and learn [sockets](https://www.tutorialspoint.com/unix_sockets/what_is_socket.htm).

# Installation
In order to run the server, download the repository 

export the environment variables below, or resort to the default values:
1. JWT_SECRET (The JWT secret required to decode the token).
2. JWT_ACCESS_TOKEN_VALIDITY (The validity in ms for the JWT access token).
3. SOCKET_REDIS_PORT (The port of the Redis database).
4. SOCKET_REDIS_HOST (The host of the Redis database).
5. SOCKET_REDIS_DB_NUM (The database number).

Finally, perform the following steps:

1. ```npm install```
2. ```node app.js (The app will run on port 1337)```

In order to interact with the server, download the [client application](https://github.com/nicolaselkhoury/nk-realtime-service-client), and run it. 

# APIs

Before any socket connects to the server, a JWT token is passed as a parameter through the initial handshake (see file: ```config/sockets.js```. Only requests with a valid JWT token will successfully establish a connection with the server. All of the APIs are triggered by a Socket request (generated by the client):

## Follow user
This API simulates a user following another user. The API will add the user to the room of the followed user, and broadcast a message to all the sockets in the room, that a user has joined the room.

## Unfollow user
This API simulates a user unfollowing another user. The API will remove the user from the room of the followed user, and broadcast a message to all the sockets in the room, that a user has left the room.

## Broadcast Message
HTTP API sends a custom message to be broadcasted either to a room, or to all the sockets connected to the server.

### Sample Request

curl --location --request POST 'localhost:1337/message/broadcast' \
--header 'Content-Type: application/json' \
--data-raw '{
    "room": "Alice",
    "message": "Hello from the outside" 
}'

## Get Socket ID
This API retrieves the socket ID of the user and returns it.

# Future Work

This is a small pilot project, and is missing a lot of enhancements, including but not limited to:

1. More realistic and complex APIs.
2. APIs triggered by HTTP calls, which in turn trigger socket events back to the client.